
var screen_width = $(window).width();
var win_scroll = $(this).scrollTop();
var header_height = $('.header-wrap').outerHeight();
var header_pad_top_n_bottom = parseInt($('.header-wrap .header').css('padding-top'));
var sidebar_click_set_overflow = false;
//var nav_icon_height = $('.nav-content-icon').height();
//var nav_label_font_size = parseInt($('.nav-content-label').css('font-size'));

$(document).on('click', function(event) {

	//User Popup
	if($(event.target).closest('.user-contents').length == 0){
		if($('.user-setting .user-contents').is(':visible')){
			$('.user-setting .user-contents').hide();
		}
	}

	//Menu popup
	if ($(event.target).closest('.sidebar-menu-wrap').length == 0) {
		// Hide the menus
		if($('.sidebar-menu').is(':visible')){
			$('.sidebar-menu').hide();
		}
	}
});

$(document).ready(function(){
	//initialize
	$('.header-wrap').data('size','big');
	$('.header .filter-bar').data('size','small');
	$('.sidebar-menu').stop().animate({'height': '0%'},300, function(){
		$(this).css('display','none');
	});
	
	//call at page load
	set_player_position();
	//set_ads();
	//set_sidebar_btn();
	set_sidebar_height();
	//set_sidebar_btn_position();
	set_nav_arrow_n_label_position();
	
	// EVENTS
	//window resize
	$(window).resize(function(){
		win_scroll = $(this).scrollTop();
		screen_width = $(window).width();

		set_player_position();
		//set_ads();
		//set_sidebar_btn();
		//set_sidebar_overflow();
		set_sidebar_height();
		set_filter_bar_width();
		
		if(screen_width > 480){
			reset_shrink_expand_searchbar();
		} 
		if(screen_width > 463){
			reset_mobile_player_position();
		} else {
			set_mobile_player_position();
		}
	});
	//window scroll
	$(window).scroll(function(){
		win_scroll = $(this).scrollTop();

		set_player_position();
		shrink_expand_header();
		set_mobile_player_position();
		//set_sidebar_btn_position();
	});
	//sidebar
	$('.sidebar-menu-wrap .btn').click(function(event){
		var sidebar_wrap = $(this).closest('.sidebar-menu-wrap');
		var sidebar_menu = sidebar_wrap.find('.sidebar-menu');
		var sidebar_placeholder = sidebar_wrap.find('.sidebar-placeholder');

		if($('.user-setting .user-contents').is(':visible')){
			$('.user-setting .user-contents').hide();
		}
		
		if(sidebar_menu.is(':visible')){
			
			sidebar_menu.css('display','none');//.stop().hide(10);
			
/*			sidebar_menu.stop().animate({'height': '0%'},150, function(){
				$(this).css('display','none');
			});
*/			
			/*sidebar_menu.removeClass('js-css-display-block');
			sidebar_menu.addClass('js-css-display-none'); */
			//$('.sidebar-menu-adjacent').removeClass('js-mobile-display-none');
		} else {
			
			set_sidebar_height();
			
			sidebar_menu.css('display','block');//.stop().show(10);

/*			
			sidebar_menu.css('display','block').stop().animate({'height': '100%'},50, function(){
		    	//$('.sidebar-menu-adjacent').addClass('js-mobile-display-none');
		    });
*/			
			/* Search button Event */
			elem = $('.header .filter-fake-btn');
			elem_wrap = elem.closest('.filter-bar');
			duration = 200;

		    if(elem_wrap.data('size') == 'big'){
		    	elem_wrap.data('size','small');
		    	width = $('.header div.search-button').width() -2;
		    	elem_wrap.stop().animate({'width': width + 'px'},duration, function(){
					//$('.header-logo').css('display','block');
		    		$('.header-logo').removeClass('js-css-miniscreen-display-none').addClass('js-css-miniscreen-display-block');
				});
		    	elem.fadeIn(duration);
		    	$('.header div.search-button').fadeOut(10);
		    	//$('.overlay').css('display', 'none');
		    	$('.overlay').removeClass('js-css-miniscreen-display-block').addClass('js-css-miniscreen-display-none');
		    	$('body').css('overflow','auto');
			}
			/***************/
		    /*
			sidebar_menu.removeClass('js-css-display-none');
			sidebar_menu.addClass('js-css-display-block');
			$('.sidebar-menu-adjacent').addClass('js-mobile-display-none'); */
			// set height of lower-sidebar
			if(sidebar_click_set_overflow == false){
				sidebar_click_set_overflow = true;
				//set_sidebar_overflow();
			}
		}
		
		event.stopPropagation();
	});
	//Header Search Button
	$('.header .filter-fake-btn').click(function(){
		shrink_expand_searchbar();
	});
	//Overlay
	$('.overlay').click(function(){
		shrink_expand_searchbar();
	});
	//Show Hide
	$('.sh-btn').click(function(){
		var sh_wrap = $(this).closest('.sh');
		var sh_content = sh_wrap.find('.sh-content');
		var sh_speed = 200; //miliseconds

		if(sh_content.is(':visible')){
			sh_content.slideUp(sh_speed);
		} else {
			sh_content.slideDown(sh_speed);
		}
	});
	/*** Dropdown ***/
	//Dropdown change event
	$('.dropdown .dropdown-select').change(function(){
		var main_container = $(this).closest('.dropdown');
		var val = $(this).val();
		var txt = $(this).find('option[value="' + val + '"]').text();

		main_container.find('.dropdown-label').html(txt);
	});
	//trigger first option
	$.each($('.dropdown .dropdown-select'), function(i, elem){
		elem = $(elem);
		if(elem.find('option[selected]').length == 0){
			//get first option's value
			elem_option_val = elem.find('option:first-child').attr('value');
		} else {
			//get selected option's value
			elem_option_val = elem.find('option[selected]:first').attr('value');
		}
		//set dropdown value to first option's value
		elem.val(elem_option_val);
		//trigger change event on dropdown after setting new value
		elem.trigger('change');
	});
	/* end - Dropdown */

	//MISCELLENOUS
	/*** Highlight search key ***/
	if(search_key){
		$.each($('.list-heading .list-anc'), function(){
			$(this).html($(this).text().replace(new RegExp(search_key,"i"), '<' + 'span class="highlight">$&</' + 'span>'));
		});
	}
	/* end - highlight search key */

	//TRIGGER
	//Show Hide trigger
	$('.sh-btn').trigger('click');

	/*** Trailer ***/
	// hide trailer wrap at start
	$('.content-abstract-trailer').hide(1);

	$('.content-abstract-trailer-btn').click(function(){
//console.log(trailer_url);
		if($('.content-abstract-trailer').is(':visible')){
			hide_trailer($(this));
		} else {
			// call ajax when empty
			if($('.content-abstract-trailer:hidden').is(':empty')){
				$.ajax({
                    type: 'get',
                    url: trailer_url,
                    data: {'width':'100%', 'aspectratio':'16:9'},
                    dataType: 'html',
                    success: function (data) {
                    	if(data){
                    		$('.content-abstract-trailer:hidden').show(500, function(){
                    			$(this).html(data);
	                    	});
                    		$('.content-abstract-trailer-btn').html($('.content-abstract-trailer-btn').html().replace("Watch", "Close"));
                    	}
                    }
				});
			} else {
				show_trailer($(this));
			}
		}
	});
	/* end - Trailer */
	
	/* Meta Description */
	$('.meta-description-btn').click(function(){
		if( $('.meta-description').is(':visible') ){
			$(this).css('background-position', 'left top');
			$('.meta-description').css('display', 'none');
		} else {
			$(this).css('background-position', 'left -20px');
			$('.meta-description').css('display', 'block');			
		}
	});
	/* end - meta description */
});

//Filter form submit - remove empty fields
$(".filter-bar form").submit(function(){
	//$(this).find(':input[value=""]').attr("disabled", "disabled");
	$(this).find(':input').each(function() {
        //console.log($(this).val());
        if($(this).val() == ""){
        	$($(this)).prop('disabled', true);
        }
    });

    return true; // ensure form still submits
});

//FUNCTIONS
/*** Player ***/
function set_player_position(){
	var elem = $(".player");
	if(elem.length > 0){
		var player_height = parseInt(elem.css('padding-top')) + elem.height();
		var player_position_top= elem.offset().top;
		var player_position_bottom= player_position_top + player_height;

		if((win_scroll + header_height) >= player_position_bottom){
			elem.find('.player-video').addClass('player-sticky-top-right');
		} else {
			elem.find('.player-video').removeClass('player-sticky-top-right');
		}
	}
}
/* end - Player */
function set_mobile_player_position(){
	if(screen_width <= 463){
		var elem = $(".player");
		if(elem.length > 0){
			var player_position_top= elem.offset().top;
			var pad = 2;
			var header_height_increament = 10;
			var head_height = (header_inner_height - header_height_increament) + pad*2;
			
			if(win_scroll >= player_position_top - head_height){
				elem.find('.player-video').addClass('player-mobile-fixed').css({'position':'fixed', 'top': head_height + 'px', 'z-index':'1000', 'bottom':'auto', 'left':'0', 'right':'auto', 'height':'auto'});
			} else {
				reset_mobile_player_position();
			}
		}
	}
}
function reset_mobile_player_position(){
	var elem = $(".player");
	elem.find('.player-video').removeClass('player-mobile-fixed').removeAttr('style');
}
/*** Set Nav Arrow n Label Position ***/
function set_nav_arrow_n_label_position(){
	$('.nav-content-list').each(function(i, e){
		wrap_default_style = $(e).find('.nav-content-label-wrap').attr('style');
		wrap_default_style = typeof default_style !== 'undefined' ? default_style : '';
		
		li_width = $(e).width();
		//console.log(li_width);
		
		$(e).find('.nav-content-label-wrap').css({'visibility':'hidden','display':'block'});
		
		label_width = $(e).find('.nav-content-label-wrap').outerWidth();
		//console.log(label_width);
		arrow_inner_width = $(e).find('.nav-content-label-arrow-inner').outerWidth();
		arrow_outer_width = $(e).find('.nav-content-label-arrow-outer').outerWidth();
		
//console.log(arrow_inner_width);

		$(e).find('.nav-content-label-wrap').attr('style', wrap_default_style);
		
		wrap_left = (li_width - label_width)/2;
		arrow_inner_left = (label_width - arrow_inner_width)/2;
		arrow_outer_left = (label_width - arrow_outer_width)/2;
		
		$(e).find('.nav-content-label-wrap').css({'left': wrap_left + 'px'});
		$(e).find('.nav-content-label-arrow-inner').css({'left': arrow_inner_left + 'px'});
		$(e).find('.nav-content-label-arrow-outer').css({'left': arrow_outer_left + 'px'});
	});
}
/* end - Set Nav label position */

/*** Shrink Expand Header ***/
var logo_height = $('.header-logo').height();
var logo_width = $('.header-logo').width();
var header_inner_height = $('.header').height();
var nav_marg_top = parseInt($('.nav-content').css('margin-top'));
var user_marg_top = parseInt($('.user-setting').css('margin-top'));
/*//store height of label to itself
var nav_label_elems = Array();
$(".nav-content-label").each(function (i, e) {
	nav_label_elems.push({'elem': $(e), 'width': $(e).closest('li').width(), 'height': $(e).height()});
 //$(this).data("width", $(this).outerWidth());
 //$(this).data("height", $(this).outerHeight());
});
$.each(nav_label_elems, function(i, e){
	console.log(e.width);
});*/
function shrink_expand_header(){
	var elem			= $('.header-wrap');
	var duration		= 200;

	
	
	
	
	/********************************************/
//	var header_height = elem.find('.header').outerHeight();
	var btn_height = $('.sidebar-menu-wrap .btn').height();
	var header_height_increament = 10;
	/*
	if(btn_height < header_height){
		btn_top = (header_height - btn_height)/2;
		//$('.sidebar-menu-wrap .btn').css('top', btn_top + 'px');
		$('.sidebar-menu-wrap .btn').stop().animate({'top': btn_top + 'px'},duration);
	} else {
		//$('.sidebar-menu-wrap .btn').css('top', '0px');		
		$('.sidebar-menu-wrap .btn').stop().animate({'top': '0px'},duration);
	}*/
	/*********************************************/
	
	
	
	
	
	if(win_scroll > 50){
	    if(elem.data('size') == 'big'){
	    	elem.data('size','small');
	    	pad = 2;
	    	logo_ratio = logo_width/logo_height;
	    	
	    	total_header_height = header_inner_height + (pad * 2) - header_height_increament;
	    	btn_top = (total_header_height - btn_height)/2;
	    	sidebar_menu_top = 34;//btn_top + btn_height;
	    	$('.sidebar-menu').stop().animate({'top': sidebar_menu_top + 'px'},duration);
	    	//$('.sidebar-menu-wrap .btn').stop().animate({'top': btn_top + 'px'},duration);
	    	$('.sidebar-menu-wrap .btn').stop().animate({'margin-top': '0'},duration);
	    	$('.header .filter-bar').stop().animate({'margin-top': '4px'},duration);
	    	
	    	//$('.nav-content-icon').stop().animate({'width': '0px', 'height' : '0px'},duration);
	    	//$('.nav-content-label').css('text-transform', 'uppercase').stop().animate({'font-size': '11px'},duration);
	    	//$('.nav-content-label').stop().animate({'width': '0', 'height': '0'}, duration);
	    	$('.nav-content').stop().animate({'margin-top': '5px'},duration);
	    	$('.user-setting').stop().animate({'margin-top': '3px'},duration);
	    	
	    	$('.header-logo').stop().animate({'width': ((logo_height - header_height_increament)*logo_ratio) + 'px', 'height': (logo_height - header_height_increament) + 'px'},duration);
	    	
	    	elem.find('.header').stop().animate({'height': (header_inner_height - header_height_increament) + 'px','padding-top': pad + 'px', 'padding-bottom' : pad + 'px'},duration);
	    	//elem.css('background-color', '#141414');
	    	//elem.find('.header').stop().animate({'padding-top': '2px', 'padding-bottom' : '2px'},duration);
	    	//$('.sidebar-menu-wrap .btn').animate({'top': '8px'},duration);
	    	//$('.sidebar-menu').animate({'padding-top': '-=' + header_pad_top_n_bottom*2 + 'px'},duration);
	    }
	    
	} else {
	    if(elem.data('size') == 'small'){
	    	elem.data('size','big');
	    	pad = header_pad_top_n_bottom;
	    	
	    	total_header_height = elem.find('.header').height() + (pad * 2) + header_height_increament;
	    	btn_top = 6; //(elem.find('.sidebar-menu-wrap').height() - btn_height)/2;
	    	sidebar_menu_top = 38;//btn_top + btn_height;
	    	$('.sidebar-menu').stop().animate({'top': sidebar_menu_top + 'px'},duration);
	    	//$('.sidebar-menu-wrap .btn').stop().animate({'top': btn_top + 'px'},duration);
	    	$('.sidebar-menu-wrap .btn').stop().animate({'margin-top': '4px'},duration);
	    	$('.header .filter-bar').stop().animate({'margin-top': '9px'},duration);
	    	
	    	//$('.nav-content-icon').stop().animate({'width': '100%', 'height' : nav_icon_height + 'px'},duration);
	    	//$('.nav-content-label').css('text-transform', 'none').stop().animate({'font-size': nav_label_font_size + 'px'},duration);
	    	$('.header-logo').stop().animate({'width': logo_width + 'px', 'height': logo_height + 'px'},duration);
	    	//$('.nav-content-label').stop().animate({'width': 'auto', 'height': 'auto'}, duration);
	    	
	    	$('.nav-content').stop().animate({'margin-top': nav_marg_top + 'px'},duration);
	    	$('.user-setting').stop().animate({'margin-top': user_marg_top + 'px'},duration);
	    	/*
	    	$.each(nav_label_elems, function(i, e){
	    		e.elem.stop().animate({'width': e.width + 'px', 'height': e.height + 'px'}, duration);
	    		//$(this).stop().animate({'width': $(this).data("width") + 'px', 'height': $(this).data("height") + 'px'}, duration);
	    	});
	    	*/
	    	elem.find('.header').stop().animate({'height': header_inner_height + 'px','padding-top': pad + 'px', 'padding-bottom' : pad + 'px'},duration);
	    	//elem.css('background-color', 'transparent');
	    	//elem.find('.header').stop().animate({'padding-top': header_pad_top_n_bottom + 'px', 'padding-bottom' : header_pad_top_n_bottom + 'px'},duration);
	    	//$('.sidebar-menu-wrap .btn').animate({'top': '6px'},duration);
	    	//$('.sidebar-menu').animate({'padding-top': '+=' + header_pad_top_n_bottom*2 + 'px'},duration);
	    }
	}
	
	
	
	//if(btn_height < header_height){
		
	//} else {
	//	btn_top = 0;
	//}
	
}
/* end - Shrink Expand Header */

/*** Shrink Expand Header Searchbar ***/
function shrink_expand_searchbar(){
	elem = $('.header .filter-fake-btn');
	elem_wrap = elem.closest('.filter-bar');
	duration = 200;

    if(elem_wrap.data('size') == 'big'){
    	elem_wrap.data('size','small');
    	width = $('.header div.search-button').width() -2;
    	elem_wrap.stop().animate({'width': width + 'px'},duration, function(){
			//$('.header-logo').css('display','block');
    		$('.header-logo').removeClass('js-css-miniscreen-display-none').addClass('js-css-miniscreen-display-block');
    		elem_wrap.removeClass('filter-bar-active');
		});
    	elem_wrap.removeClass('filter-bar-expanded');
    	elem.fadeIn(duration);
    	$('.header div.search-button').fadeOut(10);
    	//$('.overlay').css('display', 'none');
    	$('.overlay').removeClass('js-css-miniscreen-display-block').addClass('js-css-miniscreen-display-none');
    	$('body').css('overflow','auto');
	} else {
		/* Sidebar Menu Event */
		var sidebar_wrap = $('.sidebar-menu-wrap');
		var sidebar_menu = sidebar_wrap.find('.sidebar-menu');

		if(sidebar_menu.is(':visible')){
			sidebar_menu.stop().animate({'height': '0%'},1, function(){
				$(this).css('display','none');
			});
			//$('.sidebar-menu-adjacent').removeClass('js-mobile-display-none');
		}
		/*************/
		
    	elem_wrap.addClass('filter-bar-expanded');
    	elem_wrap.addClass('filter-bar-active');
		
		elem_wrap.data('size','big');
		//$('.header-logo').css('display','none');
		$('.header-logo').removeClass('js-css-miniscreen-display-block').addClass('js-css-miniscreen-display-none');
		//$('.overlay').css('display', 'block');
		$('.overlay').removeClass('js-css-miniscreen-display-none').addClass('js-css-miniscreen-display-block');
    	$('body').css('overflow','hidden');
    	
    	var admin_menu = $('.header .user-setting');
    	if(admin_menu.length){
    		var admin_menu_width = $('.header .user-setting').outerWidth();
    	}else{
    		var admin_menu_width = 0;
    	}
    	
    	width = $('.header').width() - (admin_menu_width + $('.header .sidebar-menu-wrap').outerWidth()) - 30;
    	elem.fadeOut(10);
    	$('.header div.search-button').fadeIn(duration);
    	elem_wrap.stop().animate({'width': width + 'px'},duration);
	}
}
function reset_shrink_expand_searchbar(){
	elem = $('.header .filter-fake-btn');
	elem_wrap = elem.closest('.filter-bar');
	duration = 1;

	elem_wrap.data('size','small');

	width = $('.header div.search-button').width() -2;

	elem_wrap.stop().css('width', width + 'px').removeClass('filter-bar-expanded filter-bar-active');
	$('.header-logo').removeClass('js-css-miniscreen-display-none').removeClass('js-css-miniscreen-display-block');

	elem.css({'display': 'block'});//.fadeIn(duration);
	$('.header div.search-button').css({'display': 'none'});//.fadeOut(duration);
	$('.overlay').removeClass('js-css-miniscreen-display-block').removeClass('js-css-miniscreen-display-none');
	$('body').css('overflow','auto');
}
/* end - Shrink Expand Header Searchbar */
/*** ADS - Show n Hide ***//*
function set_ads(){
	$.each($('.ad-wrap'), function(){
		elem_width = $(this).find('> *').not('.ad-tag').outerWidth();

		if(elem_width > screen_width){
			$(this).addClass('js-css-display-none').removeClass('js-css-display-block');
		} else {
			$(this).addClass('js-css-display-block').removeClass('js-css-display-none');
		}
	});
}*/
/* end - Show n Hide */

/*** Sidebar Button Position ***/
function set_sidebar_btn(){
	body_width = $('body').width();
	width = $('.header').width();

	pos = (body_width - width)/2;

	$('.sidebar-menu-wrap .btn').css('right', pos + 'px');
}
/* end - Sidebar Button Position */
/*** Sidebar Overflow ***/
function set_sidebar_overflow(){
	win_height = $(window).height();
	excluding_height = parseInt($('.sidebar-menu').css('padding-top')) + $('.sidebar-menu-wrap .sidebar-menu-upper').outerHeight(true) + parseInt($('.sidebar-menu-wrap .sidebar-menu-lower').css('padding-top')) + parseInt($('.sidebar-menu-wrap .sidebar-menu-lower').css('padding-bottom'));

	$('.sidebar-menu-lower').css('height', win_height - excluding_height + 'px');
}
/* end - Sidebar Overflow */

/*** Sidebar Height ***/
//set default height of hidden element
var sidebar_default_css  = $(".sidebar-menu").attr("style");
var sidebar_wrap_default_css = $('.sidebar-menu-wrap').attr("style");

$(".sidebar-menu-wrap, .sidebar-menu")
    .css({
        position:   'absolute', // Optional if #myDiv is already absolute
        visibility: 'hidden',
        display:    'block'
    });

var default_sidebar_height = $('.sidebar-menu-list').height();

$(".sidebar-menu").attr("style", sidebar_default_css ? sidebar_default_css : "");
$(".sidebar-menu-wrap").attr("style", sidebar_wrap_default_css ? sidebar_wrap_default_css : "");

function set_filter_bar_width(){
	if($('.header .filter-bar').hasClass('filter-bar-expanded')){
		width = $('.header').width() - ($('.header .user-setting').outerWidth() + $('.header .sidebar-menu-wrap').outerWidth()) - 30;
		$('.header .filter-bar').css('width', width + 'px');
	}
}
function set_sidebar_height(){
//console.log(default_sidebar_height);
	//default_sidebar_max_height = 420;
	var default_sidebar_min_height = 200;
	var win_height = $(window).height();
	//win_width = $(window).width();

	is_manual_visibility = false;
	if(!$(".sidebar-menu").is(':visible')){
		is_manual_visibility = true;
		$(".sidebar-menu")
	    .css({
	        position:   'absolute', // Optional if #myDiv is already absolute
	        visibility: 'hidden',
	        display:    'block'
	    });
	}
	
	//position of sidebar
	var offset = $('.sidebar-menu-list').offset();
    var sidebar_pos_y = offset.top - $(window).scrollTop();
	
    sidebar_max_height = (win_height - sidebar_pos_y) - 5;
//console.log(sidebar_max_height);
	//adjust min possible height
	if(sidebar_max_height < default_sidebar_min_height){
		sidebar_max_height = default_sidebar_min_height;
	}
	//adjust upto default height
	if(sidebar_max_height > default_sidebar_height){
		sidebar_max_height = default_sidebar_height;
	}
	
	//set height
	$('.sidebar-menu-list').css('max-height', sidebar_max_height + 'px');
	
	if(is_manual_visibility){
		$(".sidebar-menu").attr("style", sidebar_default_css ? sidebar_default_css : "");
	}
	
}
/* end - Sidebar Height */

/*** Sidebar Button Position ***/
function set_sidebar_btn_position(){
	var header_height = $('.header').outerHeight();
	var btn_height = $('.sidebar-menu-wrap .btn').height();
	var duration = 200;
	
	if(btn_height < header_height){
		btn_top = (header_height - btn_height)/2;
		//$('.sidebar-menu-wrap .btn').css('top', btn_top + 'px');
		$('.sidebar-menu-wrap .btn').stop().animate({'top': btn_top + 'px'},duration);
	} else {
		//$('.sidebar-menu-wrap .btn').css('top', '0px');		
		$('.sidebar-menu-wrap .btn').stop().animate({'top': '0px'},duration);
	}
}
/* end - Sidebar Button Position */


/*** Trailer ***/
function show_trailer(elem){
	elem.html(elem.html().replace("Watch", "Close"));
	$('.content-abstract-trailer').show(500);
	jwplayer('video-player').play();
}
function hide_trailer(elem){
	elem.html(elem.html().replace("Close", "Watch"));
	$('.content-abstract-trailer').hide(500);
	jwplayer('video-player').stop();
}
/* end - trailer */

//$(function(){
	// CHECK ALL IMAGES WITH CLASS .check-img FOR ERRORS
	$('.check-img').each(function(){
		$(this).on('error', function(){
			$(this).parent('*').addClass('img-not-available').css('position', 'relative');
		});
	});
//});
	
// Responsive Colorbox
function responsive_trailer_colorbox(width, height){
	console.log($(window).width());
    if ($(this).outerWidth() <= 480 ){
    	$(".grayBtn").colorbox({iframe:true, innerWidth:width, innerHeight:height}); //innerWidth:280, innerHeight:185
    }else{
    	$(".grayBtn").colorbox({iframe:true, innerWidth:width, innerHeight:height}); //innerWidth:415, innerHeight:300
    }
    console.log($(".cboxIframe").contents().find(".video-player-dimensions"));
    //$(".cboxIframe").contents().find(".video-player-dimensions").css({'width': '100%', 'height': '100%'});
}

function toggleCollapsibleVideo(collapsibleElement){
	$(collapsibleElement).on('shown.bs.collapse', function(){
		//$(element).find("iframe").contents().find(".video-js").removeClass("pause-vid");
		//$(element).find("iframe").contents().find(".video-js").addClass("play-vid");
		$(collapsibleElement).find("iframe").contents().find('.video-js video').get(0).play();
	});
	
	$(collapsibleElement).on('hide.bs.collapse', function(){
		//$(element).find("iframe").contents().find(".video-js").removeClass("play-vid");
		//$(element).find("iframe").contents().find(".video-js").addClass("pause-vid");
		$(collapsibleElement).find("iframe").contents().find('.video-js video').get(0).pause();
	});
}

$('iframe').on('load', function(ev) {
    $(this).contents().find(".video-js").css('overflow', 'hidden')
    .prepend("<style type='text/css'> .video-js{position: absolute; left: 0; top: 0; bottom: 0; right: 0; margin: auto; width: 100%; height: 100%; }</style>");
    //$(this).contents().find('.video-js video').get(0).pause();
});

function toggleCollapsibleVideoHTML(collapsibleElement){
	$(collapsibleElement).on('shown.bs.collapse', function(){
		//$(element).find("iframe").contents().find(".video-js").removeClass("pause-vid");
		//$(element).find("iframe").contents().find(".video-js").addClass("play-vid");
		//$(collapsibleElement).find("iframe")[0].src += "&autoplay=1";
//		var videoSource = $(collapsibleElement).find("iframe").attr('src');
//		videoSource = videoSource.replace('?autoplay=1', '');
//		console.log(videoSource);
	});
	
	$(collapsibleElement).on('hide.bs.collapse', function(){
		//$(element).find("iframe").contents().find(".video-js").removeClass("play-vid");
		//$(element).find("iframe").contents().find(".video-js").addClass("pause-vid");
		//$(collapsibleElement).find("iframe")[0].src;
		//console.log($(collapsibleElement).find("iframe")[0].src);
		var iframe = $(collapsibleElement).find("iframe");
		var videoSource = iframe.attr('src');
		videoSource = videoSource.replace('?autoplay=1', '');
		console.log(videoSource);
		iframe.attr('src', videoSource);
	});
}

$('.iframe-trailer, .iframe-watch-now-embed').on('load', function(ev) {
    //$(this).contents().find("body").addClass('test-adeel');
    
    //console.log('html-adeel');
    //.prepend("<style type='text/css'> .video-js{position: absolute; left: 0; top: 0; bottom: 0; right: 0; margin: auto; width: 100%; height: 100%; }</style>");
    //$(this).contents().find('.video-js video').get(0).pause();
});

$(document).ready(function(){
	
	toggleCollapsibleVideoHTML('#collapseTrailer');
	
	$('[id^="collapseWatchNowEmbed"]').each(function(index){
		var id = '#collapseWatchNowEmbed-'+index;
		toggleCollapsibleVideo(id);
	});
	//toggleCollapsibleVideo('#collapseWatchNowEmbed-0');
	//toggleCollapsibleVideo('#collapseWatchNowEmbed-1');
	
	toggleCollapsibleVideo('#collapseWatchNowHTML');
	
	$('.movieBtn, .trailer').on('click', function(){
		$('.collapse').collapse('hide');
		$(this).closest('.links').next().collapse('show');
	});
});
